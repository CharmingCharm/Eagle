{% extends "base.html" %}
{% load staticfiles %}
{% block username %}{{ request.user }}{% endblock %}
{% block title %}{{ course.name }}{% endblock %}
{% block content %}
    <div id="index-banner" class="parallax-container">
        <div class="section no-pad-bot">
            <div class="container"><br>
                <br>
                <h1 class="header center white-text text-lighten-2 text-shadow changefont">{{ course.name }}</h1>
                <div class="row center">
                    <h5 class="header col s12 light text-shadow-1">·&nbsp;Course
                        duration: {{ course.begin_time | date:'Y/m/d' }}
                        - {{ course.end_time | date:'Y/m/d' }} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;·&nbsp;Professor:
                        {% for teacher in teachers %}{{ teacher.truename }} {% endfor %}</h5>
                </div>
                <br>
                <br>
            </div>
        </div>
        <div class="parallax"><img src="{% static 'img/background2.jpg' %}" alt="Unsplashed background img 1"></div>

    </div>
    <div class="container">
        <div class="section">

            <!--   Icon Section   -->
            <div class="row">
                <div class="col l4 s12">
                    <div class="card cardpadding z-depth-1" style="padding:15px">
                        <div class="card-content">
                            <div class="row">
                                <h5>Course Information:</h5>
                                <p class="course_txt">Participants: {{ memNum }}</p>
                                <p class="course_txt">Group forming method: {{ course.form_method }}</p>
                                <p class="course_txt">Teams: 0</p>
                                <br>
                                <hr>
                                <p class="course_txt">operations:</p>
                                <br>
                                {% if request.user.field == "teacher" %}
                                    <div class="row">
                                        <div class="col l12 s12"><a
                                                class="waves-effect waves-light btn changefont orange darken-2"
                                                style="width:100%;"
                                                href="/course/{{ course_id }}/export_contribution"><i
                                                class="material-icons left">mode_edit</i> Export
                                            contribution </a></div>
                                    </div>
                                    <div class="row">
                                        <div class="col l12 s12"><a
                                                class="waves-effect waves-light btn changefont green darken-2"
                                                style="width:100%;" href="/course/{{ course_id }}/generate_student"><i
                                                class="material-icons left">cloud</i> Generate
                                            students</a></div>
                                    </div>
                                    <div class="row">
                                        <div class="col l12 s12"><a
                                                class="waves-effect waves-light btn changefont light-blue darken-2"
                                                style="width:100%;" href="/course/{{ course_id }}/modify_submission"><i
                                                class="material-icons left">cloud</i> Modify submission </a></div>
                                    </div>
                                    <div class="row">
                                        <div class="col l12 s12"><a
                                                class="waves-effect waves-light btn changefont purple darken-2"
                                                style="width:100%;" href="/course/{{ course_id }}/group_size"><i
                                                class="material-icons left">cloud</i> Set team
                                            forming </a></div>
                                    </div>
                                    <div class="row">
                                        <div class="col l12 s12"><a
                                                class="waves-effect waves-light btn changefont black darken-2"
                                                style="width:100%;" href="/course/{{ course_id }}/forming_method"><i
                                                class="material-icons left">cloud</i> Check
                                            forming
                                        </a></div>
                                    </div>
                                {% else %}
                                    <div class="row">
                                        <div class="col l12 s12"><a
                                                class="waves-effect waves-light btn changefont orange darken-2"
                                                style="width:100%;" href="/course/{{ course_id }}/member_assessment"><i
                                                class="material-icons left">mode_edit</i> Assess other </a></div>
                                    </div>
                                    <div class="row">
                                        <div class="col l12 s12"><a
                                                class="waves-effect waves-light btn changefont orange darken-2"
                                                style="width:100%;" href="/course/{{ course_id }}/leader_assessment"><i
                                                class="material-icons left">mode_edit</i> Assess other </a></div>
                                    </div>
                                    <div class="row">
                                        <div class="col l12 s12"><a
                                                class="waves-effect waves-light btn changefont green darken-2"
                                                style="width:100%;"
                                                href="/course/{{ course_id }}/teammate_management"><i
                                                class="material-icons left">cloud</i> Team forming </a></div>
                                    </div>
                                    <div class="row">
                                        <div class="col l12 s12"><a
                                                class="waves-effect waves-light btn changefont light-blue darken-2"
                                                style="width:100%;" href="/course/{{ course_id }}/vote_leader"><i
                                                class="material-icons left">cloud</i> Vote for leader </a></div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col l8 s12">
                    <div class="card cardpadding z-depth-1">
                        <div class="card-content">

                            <h5 style="font-weight: 400">Current submission list:</h5>

                            {% if submissionItem %}
                                <table class="highlight">
                                    <tr class="home_table">
                                        <th>Title</th>
                                        <th>Due date</th>
                                        <th>Percentage</th>
                                    </tr>

                                    {% for item in submissionItem_list %}

                                        <tr class="home_table"
                                            onclick="location.href='/course/{{ course.id }}/submission/{{ item.id }}';">
                                            <td>{{ item.title }}</td>
                                            <td>bulalalala</td>
                                            <td>{{ item.percentage }} %</td>
                                        </tr>

                                    {% endfor %}

                                </table>
                            {% else %}
                                <h2>Currently there is no submission item.</h2>
                            {% endif %}

                            <div class="center-align">
                                {% if data %}
                                    <ul id="pages" class="pagination">
                                        {% if data.page <= 1 %}
                                            <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a>
                                            </li>
                                        {% else %}
                                            <li class="waves-effect"><a href="?page={{ data.page|add:'-1' }}"><i
                                                    class="material-icons">chevron_left</i></a>
                                            </li>
                                        {% endif %}

                                        {% if data.first %}
                                            <li class="waves-effect"><a href="?page=1">1</a></li>
                                        {% endif %}
                                        {% if data.left %}
                                            {% if data.left_has_more %}
                                                <li><span>...</span></li>
                                            {% endif %}
                                            {% for i in data.left %}
                                                <li class="waves-effect"><a href="?page={{ i }}">{{ i }}</a></li>
                                            {% endfor %}
                                        {% endif %}
                                        <li class="active grey darken-3 waves-effect"><a
                                                href="?page={{ data.page }}">{{ data.page }}</a></li>

                                        {% if data.right %}
                                            {% for i in data.right %}
                                                <li class="waves-effect"><a href="?page={{ i }}">{{ i }}</a></li>
                                            {% endfor %}
                                            {% if data.right_has_more %}
                                                <li><span>...</span></li>
                                            {% endif %}
                                        {% endif %}
                                        {% if data.last %}
                                            <li class="waves-effect"><a
                                                    href="?page={{ data.total_pages }}">{{ data.total_pages }}</a>
                                            </li>
                                        {% endif %}

                                        {% if data.page >= total_pages %}
                                            <li class="disabled"><a href="#!"><i
                                                    class="material-icons">chevron_right</i></a>
                                            </li>
                                        {% else %}
                                            <li class="waves-effect"><a href="?page={{ data.page|add:'1' }}"><i
                                                    class="material-icons">chevron_right</i></a></li>
                                        {% endif %}

                                    </ul>
                                {% endif %}


                                <br>
                                <div id="chart" class="valign-wrapper"
                                     style="width:100%; height: 400px; margin-top: -50px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <br>
            <div class="section"></div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script type="text/javascript">
        var toast_msg;
        {% for message in msg %}
            toast_msg = "{{ message }}";
            if (!(toast_msg == 'no_msg')) {
                var $toastContent = $('<span>' + toast_msg + '</span>');
                Materialize.toast($toastContent, 4000);
            }
        {% endfor %}

        {% if submissionItem %}

            $(document).ready(function () {
                $('.parallax').parallax();
            });

            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById('chart'));

            // 指定图表的配置项和数据
            var option = {
                title: {
                    text: '',
                    subtext: '',
                    x: 'center'
                },

                // Add legend
                /*
                    legend: {
                        orient: 'vertical',
                        x: 'left',
                        data: [
                        {% for item in submissionItem %}
                            '{{ item.title }}',
                        {% endfor %}
                    ]
                },
            */
                // Add custom colors
                color: ['#ffbc34', '#4fc3f7', '#5e35b1', '#f62d51'],

                // Enable drag recalculate
                calculable: true,

                // Add series
                series: [
                    {
                        name: '',
                        type: 'pie',
                        radius: ['50%', '70%'],
                        center: ['50%', '57.5%'],
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true
                                },
                                labelLine: {
                                    show: true
                                }
                            },
                            emphasis: {
                                label: {
                                    show: true,
                                    formatter: '{b}' + ' ({d}%)',
                                    position: 'center',
                                    textStyle: {
                                        fontSize: '17',
                                        fontWeight: '500'
                                    }
                                }
                            }
                        },

                        data: [
                            {% for item in submissionItem %}
                                {value: {{item.percentage}}, name: '{{ item.title }}'},
                            {% endfor %}
                        ]
                    }
                ]
//    tooltip: {
//        trigger: 'item',
//        formatter: '{b}:({d}%)'
//    },
//    legend: {
//        orient: 'vertical',
//        left: 10,
//        data: ['presentation', 'document SRS', 'document SDS', 'group minutes']
//    },
//    series: [
//        {
//            type: 'pie',
//            radius: ['50%', '70%'],
//            avoidLabelOverlap: false,
//            label: {
//                normal: {
//                    show: false,
//                    position: 'center'
//                },
//                emphasis: {
//                    show: true,
//                    textStyle: {
//                        fontSize: '15'
//                    }
//                }
//            },
//            labelLine: {
//                normal: {
//                    show: false
//                }
//            },
//            data: [
//                {value: 20, name: 'presentation'},
//                {value: 30, name: 'document SRS'},
//                {value: 40, name: 'document SDS'},
//                {value: 10, name: 'group minutes'},
//            ]
//        }
//    ]
            };

            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);

        {% endif %}


    </script>
{% endblock %}
